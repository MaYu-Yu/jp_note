<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†é¡ç¸½è¦½èˆ‡ç®¡ç†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .category-link {
            text-decoration: none;
            color: inherit;
        }
        .category-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2) !important;
        }
        /* èª¿æ•´æŒ‰éˆ•çš„ä½ç½®èˆ‡å¤§å° */
        .delete-btn-overlay {
            position: absolute;
            top: 10px; /* å¢åŠ é ‚éƒ¨é–“è· */
            right: 10px; /* å¢åŠ å³å´é–“è· */
            z-index: 10;
            line-height: 1; 
            padding: 0.5rem; /* å¢åŠ æŒ‰éˆ•å…§é‚Šè· */
        }
        /* NEW: ç·¨è¼¯æŒ‰éˆ•ä½ç½® */
        .edit-btn-overlay {
            position: absolute;
            top: 10px; 
            right: 55px; /* å¾€å·¦ç§»ä»¥èˆ‡åˆªé™¤æŒ‰éˆ•éŒ¯é–‹ */
            z-index: 10;
            line-height: 1;
            padding: 0.5rem;
        }
        /* è®“åœ–æ¨™æœ¬èº«æ›´å¤§ */
        .delete-btn-overlay .fa-trash {
            font-size: 1.2rem; /* è‡ªå®šç¾©æ›´å¤§çš„åœ–æ¨™å¤§å° */
        }
        /* NEW: è®“ç·¨è¼¯åœ–æ¨™æœ¬èº«æ›´å¤§ */
        .edit-btn-overlay .fa-edit {
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-5 text-center">ğŸ·ï¸ åˆ†é¡ç¸½è¦½èˆ‡ç®¡ç†</h1>
        <div class="mb-4 d-flex gap-2 justify-content-center">
            <a href="{{ url_for('home') }}" class="btn btn-secondary mb-3 ms-2">ğŸ  è¿”å›é¦–é </a>
            <a href="{{ url_for('add_vocab') }}" class="btn btn-success mb-3 ms-2">ï¼‹ æ–°å¢å–®å­—</a>
            <a href="{{ url_for('add_grammar') }}" class="btn btn-info mb-3 ms-2">ï¼‹ æ–°å¢æ–‡æ³•</a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
        <div class="alert alert-info">
            {% for category, message in messages %}
            <p class="mb-0">{{ message }}</p>
            {% endfor %}
        </div>
        {% endif %}
        {% endwith %}

        {% if categories %}
        <div class="row row-cols-1 row-cols-md-3 row-cols-lg-4 g-4">
            {% for category in categories %}
            <div class="col">
                <div class="category-card card text-white bg-info mb-3 shadow">
                    <a href="{{ url_for('list_page', data_type='vocab', category=category.name) }}" class="category-link">
                        <div class="card-body">
                            <h5 class="card-title">{{ category.name }}</h5>
                            <p class="card-text">å…± {{ category.count }} ç­†</p>
                        </div>
                    </a>
                    
                    <button class="edit-btn-overlay btn btn-sm btn-light p-1" data-category="{{ category.name }}" title="ç·¨è¼¯åˆ†é¡åç¨±">
                        <i class="fas fa-edit text-primary"></i>
                    </button>
                    
                    <button class="delete-btn-overlay btn btn-sm btn-light p-1" data-category="{{ category.name }}" title="åˆªé™¤æ­¤åˆ†é¡">
                        <i class="fas fa-trash text-danger"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-warning text-center">
            ç›®å‰æ²’æœ‰ä»»ä½•åˆ†é¡ã€‚è«‹åœ¨æ–°å¢å–®å­—æˆ–æ–‡æ³•æ™‚å»ºç«‹åˆ†é¡ã€‚
        </div>
        {% endif %}

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        
        // NEW: ç·¨è¼¯æŒ‰éˆ•é‚è¼¯
        const editButtons = document.querySelectorAll('.edit-btn-overlay');
        editButtons.forEach(button => {
            button.addEventListener('click', function(event) {
                event.stopPropagation();
                event.preventDefault(); 
                
                const oldName = this.getAttribute('data-category');
                
                // å½ˆå‡ºè¼¸å…¥æ¡†è®“ä½¿ç”¨è€…è¼¸å…¥æ–°çš„åˆ†é¡åç¨±
                const newName = prompt(`ç·¨è¼¯åˆ†é¡ã€Œ${oldName}ã€ã€‚è«‹è¼¸å…¥æ–°çš„åç¨±ï¼š`, oldName);

                if (newName === null || newName.trim() === '') {
                    alert('ç·¨è¼¯å–æ¶ˆæˆ–æ–°åç¨±ç‚ºç©ºã€‚');
                    return;
                }
                
                if (newName.trim() === oldName) {
                    alert('åç¨±æœªæ›´æ”¹ã€‚');
                    return;
                }
                
                // å‘¼å«å¾Œç«¯ API é€²è¡Œæ›´æ–°
                fetch(`/api/edit_category/${encodeURIComponent(oldName)}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ new_name: newName.trim() })
                })
                .then(response => {
                    if (!response.ok) {
                        // å˜—è©¦å¾éŸ¿æ‡‰ä¸­è®€å–è©³ç´°éŒ¯èª¤ä¿¡æ¯
                        return response.json().then(err => { throw new Error(err.message || `HTTP éŒ¯èª¤! ç‹€æ…‹: ${response.status}`); });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.success) {
                        window.location.reload(); // æˆåŠŸå¾Œé‡æ–°è¼‰å…¥é é¢
                    } else {
                        alert('ç·¨è¼¯å¤±æ•—: ' + (data.message || 'æœªçŸ¥éŒ¯èª¤'));
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    alert('ç·¨è¼¯éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ã€‚è«‹æª¢æŸ¥ä¼ºæœå™¨é€£ç·šã€‚\nè©³ç´°éŒ¯èª¤: ' + error.message);
                });
            });
        });

        // åŸæœ¬çš„åˆªé™¤æŒ‰éˆ•é‚è¼¯ (ä¿æŒä¸è®Š)
        const deleteButtons = document.querySelectorAll('.delete-btn-overlay');
        deleteButtons.forEach(button => {
            button.addEventListener('click', function(event) {
                event.stopPropagation();
                event.preventDefault(); 
                
                const categoryName = this.getAttribute('data-category');
                
                if (confirm(`ç¢ºå®šè¦å¾æ‰€æœ‰å–®å­—/æ–‡æ³•ä¸­ç§»é™¤ã€Œ${categoryName}ã€é€™å€‹åˆ†é¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ã€‚`)) {
                    
                    fetch(`/api/delete_category/${encodeURIComponent(categoryName)}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            window.location.reload(); 
                        } else {
                            alert('åˆªé™¤å¤±æ•—: ' + (data.message || 'æœªçŸ¥éŒ¯èª¤'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('åˆªé™¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ã€‚è«‹æª¢æŸ¥ä¼ºæœå™¨é€£ç·šã€‚');
                    });
                }
            });
        });
    });
    </script>
</body>
</html>
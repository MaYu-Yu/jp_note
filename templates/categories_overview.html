<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ†é¡ç¸½è¦½èˆ‡ç®¡ç†</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        .category-link {
            text-decoration: none;
            color: inherit;
        }
        .category-card {
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.2) !important;
        }
        /* èª¿æ•´æŒ‰éˆ•çš„ä½ç½®èˆ‡å¤§å° */
        .delete-btn-overlay {
            position: absolute;
            top: 10px; /* å¢åŠ é ‚éƒ¨é–“è· */
            right: 10px; /* å¢åŠ å³å´é–“è· */
            z-index: 10;
            line-height: 1; 
            padding: 0.5rem; /* å¢åŠ æŒ‰éˆ•å…§é‚Šè· */
            /* ä½¿ç”¨æ¨™æº– btn æ›¿ä»£ btn-sm */
        }
        /* è®“åœ–æ¨™æœ¬èº«æ›´å¤§ */
        .delete-btn-overlay .fa-trash {
            font-size: 1.2rem; /* è‡ªå®šç¾©æ›´å¤§çš„åœ–æ¨™å¤§å° */
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <h1 class="mb-5 text-center">ğŸ·ï¸ æ‰€æœ‰åˆ†é¡ç¸½è¦½èˆ‡ç®¡ç†</h1>
        <div class="mb-4 d-flex gap-2">
            <button onclick="history.back()" class="btn btn-secondary mb-3 ms-2">â† è¿”å›ä¸Šé </button>
            <a href="{{ url_for('home') }}" class="btn btn-secondary mb-3 ms-2">ğŸ  è¿”å›é¦–é </a>
        </div>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="mb-3">
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}

        {% if categories %}
        <p class="text-muted">
            é»æ“Šåˆ†é¡å¡ç‰‡å¯æŸ¥çœ‹åŒ…å«è©²æ¨™ç±¤çš„ **å–®å­—** è¨˜éŒ„ã€‚é»æ“Šå³ä¸Šè§’çš„ <i class="fas fa-trash"></i> **åˆªé™¤** æŒ‰éˆ•å¯ç§»é™¤åˆ†é¡ã€‚
        </p>
        <div class="row row-cols-2 row-cols-md-3 row-cols-lg-4 g-4">
            {% for category in categories %}
            <div class="col">
                <div class="card h-100 shadow-sm border-info category-card">
                    
                    <button class="btn btn-danger delete-category-btn delete-btn-overlay" 
                            data-category="{{ category.name }}" 
                            title="å¾æ‰€æœ‰è¨˜éŒ„ä¸­ç§»é™¤æ­¤åˆ†é¡">
                        <i class="fas fa-trash"></i>
                    </button>
                    
                    <a href="{{ url_for('list_page', data_type='vocab', category=category.name) }}" class="category-link d-block h-100">
                        <div class="card-body">
                            <h5 class="card-title text-info">{{ category.name }}</h5>
                            <p class="card-text small">
                                å–®å­—: <span class="badge bg-primary">{{ category.vocab_count }}</span>
                                æ–‡æ³•: <span class="badge bg-success">{{ category.grammar_count }}</span>
                            </p>
                        </div>
                    </a>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="alert alert-warning text-center" role="alert">
            ç›®å‰æ²’æœ‰ä»»ä½•åˆ†é¡è³‡æ–™ã€‚è«‹åœ¨æ–°å¢/ç·¨è¼¯æ™‚æ·»åŠ åˆ†é¡æ¨™ç±¤ï¼ˆä»¥é€—è™Ÿåˆ†éš”ï¼‰ã€‚
        </div>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        const deleteButtons = document.querySelectorAll('.delete-category-btn');

        deleteButtons.forEach(button => {
            button.addEventListener('click', function(event) {
                event.stopPropagation();
                event.preventDefault(); 
                
                const categoryName = this.getAttribute('data-category');
                
                if (confirm(`ç¢ºå®šè¦å¾æ‰€æœ‰å–®å­—/æ–‡æ³•ä¸­ç§»é™¤ã€Œ${categoryName}ã€é€™å€‹åˆ†é¡å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ã€‚`)) {
                    
                    fetch(`/api/delete_category/${encodeURIComponent(categoryName)}`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error(`HTTP éŒ¯èª¤! ç‹€æ…‹: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(data => {
                        if (data.success) {
                            window.location.reload(); 
                        } else {
                            alert('åˆªé™¤å¤±æ•—: ' + (data.message || 'æœªçŸ¥éŒ¯èª¤'));
                        }
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        alert('åˆªé™¤éç¨‹ä¸­ç™¼ç”ŸéŒ¯èª¤ã€‚è«‹æª¢æŸ¥ä¼ºæœå™¨é€£ç·šã€‚');
                    });
                }
            });
        });
    });
    </script>
</body>
</html>